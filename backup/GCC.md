
**GCC** 是 Linux 下的编译工具集，是 **GNU Compiler Collection** 的缩写，包含 gcc、g++ 等编译器。这个工具集不仅包含编译器，还包含其他工具集，例如 ar、nm 等。

GCC 工具集不仅能编译 C/C++语言，其他例如 Objective-C、Pascal、Fortran、Java、Ada 等语言均能进行编译。GCC 在可以根据不同的硬件平台进行编译，即能进行交叉编译，在 A 平台上编译 B 平台的程序，支持常见的 X86、ARM、PowerPC、mips 等，以及 Linux、Windows 等软件平台。

# 1. 安装 GCC  
有些纯净版的Linux默认没有gcc编译器, 需要自己安装, 在线安装步骤如下:

```shell
# 安装软件必须要有管理员权限
# ubuntu
sudo apt update   		# 更新本地的软件下载列表, 得到最新的下载地址
sudo apt install gcc g++	# 通过下载列表中提供的地址下载安装包, 并安装

# centos
sudo yum update   		# 更新本地的软件下载列表, 得到最新的下载地址
sudo yum install gcc g++	# 通过下载列表中提供的地址下载安装包, 并安装
```

gcc安装完成后，可查看版本：

```shell
# 查看 gcc 版本
gcc -v
gcc --version

# 查看 g++ 版本
g++ -v
g++ --version
```

# 2.GCC工作流程
GCC 编译器对程序的编译下图所示，分为 4 个阶段：`预处理（预编译）`、`编译` 和 `优化`、`汇编和链接`。GCC 的编译器可以将这 4 个步骤合并成一个。 先介绍一个每个步骤都分别做了写什么事:

**1.预处理**: 在这个阶段主要做了三件事: 展开头文件 、宏替换 、去掉注释行  
这个阶段需要GCC调用预处理器来完成, 最终得到的还是源文件, 文本格式  

**2.编译**: 这个阶段需要GCC调用编译器对文件进行编译, 最终得到一个汇编文件  

**3.汇编**: 这个阶段需要GCC调用汇编器对文件进行汇编, 最终得到一个二进制文件  

**4.链接**: 这个阶段需要GCC调用链接器对程序需要调用的库进行链接, 最终得到一个可执行的二进制文件

|文件后缀名|说明|gcc参数|
|:---:|:---:|:---:|
|.c|源文件|无|
|.i|预处理后的c文件|-E|
|.s|编译之后得到的汇编语言的源文件|-S|
|.o|汇编之后得到的二进制文件|-c|

> [!note]
> c语言源文件-- `预处理` --> 预处理后的文件-- `编译` --> 汇编文件-- `汇编` --> 目标文件-- `链接` --> 可执行文件  

## 2.1编译单文件
1.在 Linux 下使用 GCC 编译器编译单个文件十分简单，直接使用gcc命令后面加上要编译的c语言源文件：

```shell
gcc temp.c
```

GCC 会自动生成文件名为temp.out 的可执行文件，temp.out授予执行权限后可直接运行。  

2.也可以通过参数 -o 指定生成的可执行文件名：

```shell
gcc temp.c -o temp
```

temp就是生成的可执行文件(名称可自由指定)  
以上两种方式通过一个简单的命令就把上边提到的4个步骤就全部执行完毕了。

## 2.2单步执行编译步骤
例子更为直观，直接举例🌰  

```shell
// 假设程序对应的源文件名为 test.c
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <string.h>

int main()
{
    int array[5] = {1,2,3,4,5};
    for(int i=0; i<5; ++i)
    {
        printf("array[%d] = %d\n", i, array[i]);
    }
    return 0;
}
```

- 第一步: 对源文件进行预处理, 需要使用的gcc参数为 `-E`

```shell
# 1. 预处理, -o 指定生成的文件名
gcc -E test.c -o test.i
```

- 第二步: 编译预处理之后的文件, 需要使用的gcc参数为 `-S`

```shell
# 2. 编译, 得到汇编文件
gcc -S test.i -o test.s
```

- 第三步: 对得到的汇编文件进行汇编, 需要使用的gcc参数为 `-c`

```shell
# 3. 汇编
gcc -c test.s -o test.o
```

- 第四步: 将得到的二进制文件和标准库进制链接, 得到可执行的二进制文件, `不需要任何参数`

```shell
# 4. 链接
gcc test.o -o test
```

> [!IMPORTANT]
> 最后再次强调, 在使用gcc编译程序的时候可以通过参数控制内部自动执行几个步骤:

```shell
# 参数 -c 是进行文件的汇编, 汇编之前的两步会自动执行
$ gcc test.c -c -o app.o

# 该命令是直接进行链接生成可执行程序, 链接之前的三步会自动执行
$ gcc test.c -o app    
```


